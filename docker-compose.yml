# ============================================
# 개발용 Docker Compose
# Next.js 앱 (Supabase는 별도 실행)
# ============================================

# 사용법:
#   1. 네트워크 생성 (최초 1회): docker network create sojangnim
#   2. Supabase 시작: cd supabase/docker && docker compose up -d
#   3. 앱 시작: docker compose up -d
#   4. 로그 확인: docker compose logs -f app

name: sojangnim-dev

services:
  # Next.js 개발 서버
  app:
    build:
      context: .
      target: development
    container_name: sojangnim-app-dev
    ports:
      - "3000:3000"
    volumes:
      # 소스코드 bind mount (hot reload)
      - .:/app
      # node_modules는 컨테이너 내부 것 사용
      - /app/node_modules
      # .next 캐시 제외
      - /app/.next
    env_file:
      - .env.local
    environment:
      - NODE_ENV=development
      - WATCHPACK_POLLING=true  # Docker에서 파일 변경 감지
    networks:
      - sojangnim
    restart: unless-stopped

networks:
  sojangnim:
    name: sojangnim
    external: true  # 외부에서 생성된 네트워크 사용
