---
title: "ë©€í‹° í…Œë„ŒíŠ¸ ì•„í‚¤í…ì²˜ ê°€ì´ë“œ"
tags: [architecture, multi-tenant, scalability, extension, security]
---

# ë©€í‹° í…Œë„ŒíŠ¸ ì•„í‚¤í…ì²˜ ê°€ì´ë“œ

## ê°œìš”

ì†Œì¥ë‹˜ í”„ë¡œì íŠ¸ë¥¼ Nê°œ ì—…ì¥(í…Œë„ŒíŠ¸)ì´ ê³µìœ í•˜ëŠ” ë©€í‹° í…Œë„ŒíŠ¸ êµ¬ì¡°ë¡œ í™•ì¥í•˜ëŠ” ê°€ì´ë“œì…ë‹ˆë‹¤.

**ì ìš© ì‹œë‚˜ë¦¬ì˜¤**:
- ì—…ì¥ë§ˆë‹¤ ì™„ì „íˆ ë‹¤ë¥¸ ì œí’ˆ ì¹´íƒˆë¡œê·¸
- ì—…ì¥ë³„ë¡œ ìƒ‰ìƒ/ë¡œê³ /ë ˆì´ì•„ì›ƒì´ ì¼ë¶€ ë‹¤ë¦„
- ì†Œê·œëª¨ (5ê°œ ë¯¸ë§Œ), ì €íŠ¸ë˜í”½ í™˜ê²½
- Nê°œì˜ ë…ë¦½ í”„ë¡ íŠ¸ì—”ë“œ ë°°í¬, Supabaseë§Œ ê³µìœ 

## í•µì‹¬ êµ¬ì¡°

```mermaid
graph TB
    subgraph "ë°°í¬ ì‹œì  (ê³ ì •)"
        A[Vercel A<br/>ENV: TENANT=company-a]
        B[Vercel B<br/>ENV: TENANT=company-b]
        C[Vercel C<br/>ENV: TENANT=company-c]
    end

    subgraph "ëŸ°íƒ€ì„ (ë³€ê²½ ë¶ˆê°€)"
        A --> D[ì„œë²„ì—ì„œ tenant_id ê°•ì œ ì£¼ì…<br/>company-aë§Œ ì¡°íšŒ]
        B --> E[ì„œë²„ì—ì„œ tenant_id ê°•ì œ ì£¼ì…<br/>company-bë§Œ ì¡°íšŒ]
        C --> F[ì„œë²„ì—ì„œ tenant_id ê°•ì œ ì£¼ì…<br/>company-cë§Œ ì¡°íšŒ]
    end

    subgraph "Supabase (ê³µìœ  DB)"
        D --> G[products í…Œì´ë¸”]
        E --> G
        F --> G
        G --> H[tenant_idë¡œ ë°ì´í„° ë¶„ë¦¬]
    end
```

**í•µì‹¬ ì›ì¹™**:
1. **ë°°í¬ ì‹œ tenant ê³ ì •**: í™˜ê²½ë³€ìˆ˜ë¡œ ì„¤ì •, ëŸ°íƒ€ì„ ë³€ê²½ ë¶ˆê°€
2. **ì„œë²„ì—ì„œ ê°•ì œ í•„í„°ë§**: í´ë¼ì´ì–¸íŠ¸ëŠ” DB ì§ì ‘ ì ‘ê·¼ ë¶ˆê°€
3. **ì™„ë²½í•œ ë°ì´í„° ê²©ë¦¬**: ê° í”„ë¡ íŠ¸ì—”ë“œëŠ” ìì‹ ì˜ ë°ì´í„°ë§Œ ì ‘ê·¼

---

## ì•„í‚¤í…ì²˜ ë¹„êµ

### ë°©ì•ˆ 1: ë‹¨ì¼ DB + ë©€í‹° í…Œë„ŒíŠ¸ (ê¶Œì¥)

**ê°œë…**: í•˜ë‚˜ì˜ Supabase DB, Nê°œì˜ ë…ë¦½ í”„ë¡ íŠ¸ì—”ë“œ

```mermaid
graph TB
    A[í”„ë¡ íŠ¸ì—”ë“œ A<br/>company-a.com<br/>ë…ë¦½ ë°°í¬] --> E[Supabase 1ê°œ]
    B[í”„ë¡ íŠ¸ì—”ë“œ B<br/>company-b.com<br/>ë…ë¦½ ë°°í¬] --> E
    C[í”„ë¡ íŠ¸ì—”ë“œ C<br/>company-c.com<br/>ë…ë¦½ ë°°í¬] --> E

    E --> F[products<br/>tenant_idë¡œ êµ¬ë¶„]
```

**ì¥ì **:
- âœ… **ë¹„ìš© íš¨ìœ¨**: Supabase ë¬´ë£Œ í”Œëœìœ¼ë¡œ 5ê°œ ì—…ì¥ ì¶©ë¶„ (ì—°ê°„ $1,500 ì ˆê°)
- âœ… **ê´€ë¦¬ ë‹¨ìˆœ**: í•˜ë‚˜ì˜ DB ë°±ì—…/ë§ˆì´ê·¸ë ˆì´ì…˜
- âœ… **ì½”ë“œ ì¬ì‚¬ìš©**: ê°™ì€ ì½”ë“œë² ì´ìŠ¤, í™˜ê²½ë³€ìˆ˜ë§Œ ë‹¤ë¥´ê²Œ
- âœ… **í™•ì¥ ìš©ì´**: í…Œë„ŒíŠ¸ ì¶”ê°€ëŠ” DB ë ˆì½”ë“œ + ë°°í¬ë§Œ
- âœ… **ì™„ë²½í•œ ê²©ë¦¬**: ì„œë²„ ê°•ì œ í•„í„°ë§ìœ¼ë¡œ ë°ì´í„° ê²©ë¦¬ ë³´ì¥

**ë‹¨ì **:
- âš ï¸ ìŠ¤í‚¤ë§ˆ ë³€ê²½ ì‹œ ëª¨ë“  í…Œë„ŒíŠ¸ ì˜í–¥
- âš ï¸ ëŒ€ê·œëª¨ í™•ì¥ ì‹œ ì„±ëŠ¥ ì´ìŠˆ ê°€ëŠ¥

**ì í•©í•œ ê²½ìš°**: ì†Œê·œëª¨ (5~20ê°œ), ì €~ì¤‘íŠ¸ë˜í”½, ë¹„ìš© ìµœì†Œí™”

---

### ë°©ì•ˆ 2: í”„ë¡œì íŠ¸ë³„ Supabase ì¸ìŠ¤í„´ìŠ¤

**ê°œë…**: ê° ì—…ì¥ë§ˆë‹¤ ë³„ë„ì˜ Supabase í”„ë¡œì íŠ¸

```mermaid
graph TB
    A[í”„ë¡ íŠ¸ì—”ë“œ A] --> D[Supabase A]
    B[í”„ë¡ íŠ¸ì—”ë“œ B] --> E[Supabase B]
    C[í”„ë¡ íŠ¸ì—”ë“œ C] --> F[Supabase C]
```

**ì¥ì **:
- âœ… ì™„ì „í•œ ë¬¼ë¦¬ì  ê²©ë¦¬
- âœ… ì—…ì¥ë³„ ë…ë¦½ ìŠ¤ì¼€ì¼ë§

**ë‹¨ì **:
- âŒ **ë¹„ìš© ì¦ê°€**: Pro í”Œëœ ê¸°ì¤€ 5ê°œ Ã— $25 = $125/ì›”
- âŒ ê´€ë¦¬ ë³µì¡ë„ ë†’ìŒ

**ì í•©í•œ ê²½ìš°**: ëŒ€ê·œëª¨ (20ê°œ ì´ìƒ), ê³ íŠ¸ë˜í”½, ì—”í„°í”„ë¼ì´ì¦ˆê¸‰

---

## ê¶Œì¥ êµ¬í˜„: ë°©ì•ˆ 1 (ë‹¨ì¼ DB + Nê°œ í”„ë¡ íŠ¸ì—”ë“œ)

í˜„ì¬ ìš”êµ¬ì‚¬í•­(ì†Œê·œëª¨, ì €íŠ¸ë˜í”½, ë¹„ìš© ìµœì†Œí™”)ì— ìµœì í™”ëœ êµ¬ì¡°ì…ë‹ˆë‹¤.

### 1. ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆ ì„¤ê³„

í˜„ì¬ í”„ë¡œì íŠ¸ëŠ” **ì´ 3ê°œ í…Œì´ë¸”**ë§Œ ìˆì–´ ë§ˆì´ê·¸ë ˆì´ì…˜ì´ ë§¤ìš° ê°„ë‹¨í•©ë‹ˆë‹¤!

#### 1.1 tenants í…Œì´ë¸” ì¶”ê°€

```sql
-- supabase/migrations/20250126000000_add_multi_tenant.sql

-- í…Œë„ŒíŠ¸ ì •ë³´ í…Œì´ë¸”
CREATE TABLE tenants (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  slug TEXT UNIQUE NOT NULL,           -- 'company-a', 'company-b'
  name TEXT NOT NULL,                  -- 'ì—…ì¥ A', 'ì—…ì¥ B'
  domain TEXT,                          -- ì»¤ìŠ¤í…€ ë„ë©”ì¸ (ì„ íƒ)

  -- í…Œë§ˆ ì„¤ì • (JSONB)
  theme JSONB DEFAULT '{
    "colors": {
      "primary": "#1a1a1a",
      "accent": "#4a4a4a"
    },
    "logo_url": ""
  }'::jsonb,

  -- ë ˆì´ì•„ì›ƒ ì„¤ì • (JSONB)
  settings JSONB DEFAULT '{
    "layout": {
      "show_hero": true,
      "product_card_style": "list"
    }
  }'::jsonb,

  is_active BOOLEAN DEFAULT true,
  created_at TIMESTAMPTZ DEFAULT now(),
  updated_at TIMESTAMPTZ DEFAULT now()
);

-- ì¸ë±ìŠ¤
CREATE INDEX idx_tenants_slug ON tenants(slug);
CREATE INDEX idx_tenants_domain ON tenants(domain) WHERE domain IS NOT NULL;
```

#### 1.2 ê¸°ì¡´ 3ê°œ í…Œì´ë¸”ì— tenant_id ì¶”ê°€

```sql
-- categories, products, admin_users í…Œì´ë¸” ìˆ˜ì •
ALTER TABLE categories ADD COLUMN tenant_id UUID REFERENCES tenants(id) ON DELETE CASCADE;
ALTER TABLE products ADD COLUMN tenant_id UUID REFERENCES tenants(id) ON DELETE CASCADE;
ALTER TABLE admin_users ADD COLUMN tenant_id UUID REFERENCES tenants(id) ON DELETE CASCADE;

-- ì¸ë±ìŠ¤ ì¶”ê°€ (ì„±ëŠ¥ ìµœì í™”)
CREATE INDEX idx_categories_tenant ON categories(tenant_id);
CREATE INDEX idx_products_tenant ON products(tenant_id);
CREATE INDEX idx_admin_users_tenant ON admin_users(tenant_id);

-- ê¸°ì¡´ ë°ì´í„° ë§ˆì´ê·¸ë ˆì´ì…˜ (ë””í´íŠ¸ í…Œë„ŒíŠ¸ ìƒì„±)
INSERT INTO tenants (slug, name) VALUES ('default', 'ê¸°ë³¸ ì—…ì¥');

-- ê¸°ì¡´ ë°ì´í„°ì— ë””í´íŠ¸ tenant_id í• ë‹¹
UPDATE categories SET tenant_id = (SELECT id FROM tenants WHERE slug = 'default');
UPDATE products SET tenant_id = (SELECT id FROM tenants WHERE slug = 'default');
UPDATE admin_users SET tenant_id = (SELECT id FROM tenants WHERE slug = 'default');

-- NOT NULL ì œì•½ ì¶”ê°€
ALTER TABLE categories ALTER COLUMN tenant_id SET NOT NULL;
ALTER TABLE products ALTER COLUMN tenant_id SET NOT NULL;
ALTER TABLE admin_users ALTER COLUMN tenant_id SET NOT NULL;
```

---

### 2. ì•ˆì „í•œ í”„ë¡ íŠ¸ì—”ë“œ êµ¬í˜„ (ì„œë²„ ê¸°ë°˜)

#### ğŸš¨ ë³´ì•ˆ ì›ì¹™

**ì ˆëŒ€ ê·œì¹™**:
- âŒ í´ë¼ì´ì–¸íŠ¸ì—ì„œ Supabase ì§ì ‘ ì ‘ê·¼ ê¸ˆì§€
- âŒ í´ë¼ì´ì–¸íŠ¸ê°€ `tenant_id` ì¡°ì‘ ë¶ˆê°€ëŠ¥í•˜ê²Œ
- âœ… ì„œë²„ì—ì„œë§Œ DB ì ‘ê·¼ (Service Role Key)
- âœ… ì„œë²„ì—ì„œ `tenant_id` ê°•ì œ ì£¼ì…

---

#### 2.1 í™˜ê²½ë³€ìˆ˜ ì„¤ì •

```env
# .env.local (ë¡œì»¬ ê°œë°œ)
NEXT_PUBLIC_SUPABASE_URL=https://xxx.supabase.co
SUPABASE_SERVICE_ROLE_KEY=eyJxxx...  # ì„œë²„ ì „ìš©! NEXT_PUBLIC ì—†ìŒ!
TENANT_SLUG=company-a                # ì„œë²„ ì „ìš©! NEXT_PUBLIC ì—†ìŒ!
```

**ì¤‘ìš”**: `TENANT_SLUG`ê³¼ `SUPABASE_SERVICE_ROLE_KEY`ëŠ” ì ˆëŒ€ `NEXT_PUBLIC_` ì ‘ë‘ì‚¬ë¥¼ ë¶™ì´ì§€ ë§ˆì„¸ìš”! í´ë¼ì´ì–¸íŠ¸ì— ë…¸ì¶œë©ë‹ˆë‹¤.

---

#### 2.2 ì„œë²„ ì „ìš© Supabase í´ë¼ì´ì–¸íŠ¸

```typescript
// src/lib/supabase/server.ts
import { createClient } from '@supabase/supabase-js'

const supabaseUrl = process.env.NEXT_PUBLIC_SUPABASE_URL!
const serviceRoleKey = process.env.SUPABASE_SERVICE_ROLE_KEY! // ì„œë²„ ì „ìš©!
const tenantSlug = process.env.TENANT_SLUG! // ì„œë²„ ì „ìš©!

// Service Role Keyë¡œ í´ë¼ì´ì–¸íŠ¸ ìƒì„± (RLS ìš°íšŒ ê°€ëŠ¥)
const supabaseAdmin = createClient(supabaseUrl, serviceRoleKey, {
  auth: {
    autoRefreshToken: false,
    persistSession: false
  }
})

// ìºì‹±: ì„œë²„ ì‹œì‘ ì‹œ 1íšŒë§Œ ì¡°íšŒ
let cachedTenant: { id: string; name: string } | null = null

async function getTenant() {
  if (!cachedTenant) {
    const { data, error } = await supabaseAdmin
      .from('tenants')
      .select('id, name, theme, settings')
      .eq('slug', tenantSlug)
      .eq('is_active', true)
      .single()

    if (error || !data) {
      throw new Error(`Invalid tenant: ${tenantSlug}`)
    }

    cachedTenant = data
  }

  return cachedTenant
}

// ì„œë²„ ì»´í¬ë„ŒíŠ¸ì—ì„œ ì‚¬ìš©í•  ì•ˆì „í•œ í´ë¼ì´ì–¸íŠ¸
export async function getServerSupabase() {
  const tenant = await getTenant()

  return {
    tenant, // í…Œë„ŒíŠ¸ ì •ë³´

    // ëª¨ë“  ì¿¼ë¦¬ì— tenant_id ìë™ ì£¼ì…
    from: (table: string) => {
      return supabaseAdmin
        .from(table)
        .eq('tenant_id', tenant.id) // â† ì„œë²„ì—ì„œ ê°•ì œë¡œ í•„í„°ë§!
    }
  }
}
```

---

#### 2.3 Server Componentì—ì„œ ì‚¬ìš©

```typescript
// src/app/products/page.tsx (Server Component)
import { getServerSupabase } from '@/lib/supabase/server'

export default async function ProductsPage() {
  const supabase = await getServerSupabase()

  // tenant_idê°€ ìë™ìœ¼ë¡œ í•„í„°ë§ë¨ (í´ë¼ì´ì–¸íŠ¸ê°€ ì¡°ì‘ ë¶ˆê°€ëŠ¥!)
  const { data: products, error } = await supabase
    .from('products')
    .select('*')
    .limit(12)

  if (error) {
    return <div>ì œí’ˆì„ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</div>
  }

  return (
    <div>
      <h1>{supabase.tenant.name}</h1>
      <ProductList products={products} />
    </div>
  )
}
```

**ì¥ì **:
- âœ… ê¸°ì¡´ í˜ì´ì§€ ì½”ë“œ ê±°ì˜ ê·¸ëŒ€ë¡œ!
- âœ… `tenant_id` í•„í„°ëŠ” ì„œë²„ì—ì„œ ìë™ ì¶”ê°€
- âœ… í´ë¼ì´ì–¸íŠ¸ëŠ” DB ì ‘ê·¼ ë¶ˆê°€

---

#### 2.4 Client Component ì§€ì› (ì„ íƒ)

ì¥ë°”êµ¬ë‹ˆëŠ” ë¡œì»¬ìŠ¤í† ë¦¬ì§€ ê¸°ë°˜ì´ë¼ DB ì ‘ê·¼ ë¶ˆí•„ìš”í•˜ì§€ë§Œ, ë§Œì•½ í´ë¼ì´ì–¸íŠ¸ì—ì„œ DB ì ‘ê·¼ì´ í•„ìš”í•˜ë‹¤ë©´ API ë¼ìš°íŠ¸ë¥¼ ì‚¬ìš©:

```typescript
// src/app/api/products/route.ts
import { NextResponse } from 'next/server'
import { getServerSupabase } from '@/lib/supabase/server'

export async function GET() {
  const supabase = await getServerSupabase()

  const { data, error } = await supabase
    .from('products')
    .select('*')

  if (error) {
    return NextResponse.json({ error: error.message }, { status: 500 })
  }

  return NextResponse.json({ products: data })
}
```

```typescript
// í´ë¼ì´ì–¸íŠ¸ì—ì„œ í˜¸ì¶œ
'use client'

export default function ProductsClient() {
  const [products, setProducts] = useState([])

  useEffect(() => {
    fetch('/api/products')
      .then(res => res.json())
      .then(data => setProducts(data.products))
  }, [])

  return <ProductList products={products} />
}
```

---

#### 2.5 ë™ì  í…Œë§ˆ (ì„ íƒ ì‚¬í•­)

ì—…ì¥ë³„ ìƒ‰ìƒ/ë¡œê³ ê°€ ë‹¤ë¥´ë‹¤ë©´:

```typescript
// src/app/layout.tsx
import { getServerSupabase } from '@/lib/supabase/server'

export default async function RootLayout({ children }: { children: React.ReactNode }) {
  const { tenant } = await getServerSupabase()

  return (
    <html lang="ko">
      <head>
        <title>{tenant.name}</title>
        <style dangerouslySetInnerHTML={{ __html: `
          :root {
            --color-primary: ${tenant.theme.colors.primary};
            --color-accent: ${tenant.theme.colors.accent};
          }
        ` }} />
      </head>
      <body>
        {children}
      </body>
    </html>
  )
}
```

---

### 3. ë°°í¬ ì „ëµ

#### Nê°œì˜ Vercel í”„ë¡œì íŠ¸ ë°°í¬

**ê°™ì€ Git ì €ì¥ì†Œ, í™˜ê²½ë³€ìˆ˜ë§Œ ë‹¤ë¥´ê²Œ!**

##### í”„ë¡ íŠ¸ì—”ë“œ A ë°°í¬

```bash
# Vercel Dashboard â†’ New Project â†’ Import Git Repository
# Project Name: sojangnim-company-a
# Environment Variables:
#   NEXT_PUBLIC_SUPABASE_URL=https://xxx.supabase.co
#   SUPABASE_SERVICE_ROLE_KEY=eyJxxx...
#   TENANT_SLUG=company-a  # â† ì´ê²ƒë§Œ ë‹¤ë¦„!
# Domain: company-a.com
```

##### í”„ë¡ íŠ¸ì—”ë“œ B ë°°í¬

```bash
# Project Name: sojangnim-company-b
# Environment Variables:
#   NEXT_PUBLIC_SUPABASE_URL=https://xxx.supabase.co  # ë™ì¼
#   SUPABASE_SERVICE_ROLE_KEY=eyJxxx...               # ë™ì¼
#   TENANT_SLUG=company-b  # â† ë‹¤ë¥¸ ê°’!
# Domain: company-b.com
```

**ê²°ê³¼**:
- `company-a.com` ë°©ë¬¸ â†’ company-a ë°ì´í„°ë§Œ ì¡°íšŒ
- `company-b.com` ë°©ë¬¸ â†’ company-b ë°ì´í„°ë§Œ ì¡°íšŒ
- **ëŸ°íƒ€ì„ì— ë³€ê²½ ë¶ˆê°€ëŠ¥** (ì¬ë°°í¬ í•„ìš”)

---

### 4. ë³´ì•ˆ ê²€ì¦

#### âœ… ê° í”„ë¡ íŠ¸ì—”ë“œëŠ” ìì‹ ì˜ ë°ì´í„°ë§Œ ì ‘ê·¼

| ê³µê²© ì‹œë‚˜ë¦¬ì˜¤ | ë°©ì–´ ê°€ëŠ¥ ì—¬ë¶€ |
|--------------|--------------|
| ë¸Œë¼ìš°ì € ì½˜ì†”ì—ì„œ ë‹¤ë¥¸ tenant ë°ì´í„° ìš”ì²­ | âœ… ë¶ˆê°€ëŠ¥ (ì„œë²„ í™˜ê²½ë³€ìˆ˜) |
| ë„¤íŠ¸ì›Œí¬ ìš”ì²­ ì¡°ì‘ | âœ… ë¶ˆê°€ëŠ¥ (ì„œë²„ì—ì„œ ê°•ì œ ì£¼ì…) |
| ì§ì ‘ Supabase ì ‘ê·¼ | âœ… ë¶ˆê°€ëŠ¥ (Service Role KeyëŠ” ì„œë²„ë§Œ) |
| `TENANT_SLUG` ë³€ìˆ˜ ì¡°ì‘ | âœ… ë¶ˆê°€ëŠ¥ (ë¹Œë“œ íƒ€ì„ì— ì¸ë¼ì¸í™”) |

#### ì‹¤ì œ ë™ì‘ ê²€ì¦

```typescript
// í”„ë¡ íŠ¸ì—”ë“œ A (company-a)ì—ì„œ ì•…ì˜ì  ì‹œë„
// 1. ë¸Œë¼ìš°ì € ì½˜ì†”ì—ì„œ ë‹¤ë¥¸ í…Œë„ŒíŠ¸ ë°ì´í„° ìš”ì²­ ì‹œë„
await fetch('/api/products') // â† ì„œë²„ê°€ company-aë¡œ ê°•ì œ í•„í„°ë§!
// ê²°ê³¼: company-a ë°ì´í„°ë§Œ ë°˜í™˜

// 2. í™˜ê²½ë³€ìˆ˜ ì¡°ì‘ ì‹œë„ (ëŸ°íƒ€ì„)
process.env.TENANT_SLUG = 'company-b'
// â† Next.jsëŠ” ë¹Œë“œ íƒ€ì„ì— ì¸ë¼ì¸í™”í•˜ë¯€ë¡œ ì†Œìš©ì—†ìŒ!
// ê²°ê³¼: ì—¬ì „íˆ company-a ë°ì´í„°ë§Œ ë°˜í™˜
```

---

## ìš´ì˜ ê°€ì´ë“œ

### ìƒˆ í…Œë„ŒíŠ¸ ì¶”ê°€

1. **DBì— í…Œë„ŒíŠ¸ ë ˆì½”ë“œ ì‚½ì…**:
```sql
INSERT INTO tenants (slug, name, theme)
VALUES (
  'company-c',
  'ì—…ì¥ C',
  '{"colors": {"primary": "#000", "accent": "#f00"}}'::jsonb
);
```

2. **ì¹´í…Œê³ ë¦¬/ì œí’ˆ ë°ì´í„° ì…ë ¥** (Supabase Dashboard)

3. **ìƒˆ Vercel í”„ë¡œì íŠ¸ ìƒì„±**:
   - Git ì €ì¥ì†Œ ì—°ê²°
   - í™˜ê²½ë³€ìˆ˜: `TENANT_SLUG=company-c`
   - ë„ë©”ì¸: `company-c.com`

4. **ë°°í¬ ë° í…ŒìŠ¤íŠ¸**

---

### í…Œë„ŒíŠ¸ ì„¤ì • ë³€ê²½

```sql
-- í…Œë§ˆ ìƒ‰ìƒ ë³€ê²½
UPDATE tenants
SET theme = jsonb_set(theme, '{colors,primary}', '"#2d2d2d"')
WHERE slug = 'company-a';

-- ë ˆì´ì•„ì›ƒ ì„¤ì • ë³€ê²½
UPDATE tenants
SET settings = jsonb_set(settings, '{layout,show_hero}', 'false')
WHERE slug = 'company-b';
```

**ì¬ë°°í¬ ë¶ˆí•„ìš”**: DB ë³€ê²½ë§Œìœ¼ë¡œ ì¦‰ì‹œ ë°˜ì˜!

---

### tenant_id ë³€ê²½í•˜ë ¤ë©´?

**ìœ ì¼í•œ ë°©ë²•: ì¬ë°°í¬**

```bash
# 1. Vercel Dashboardì—ì„œ í™˜ê²½ë³€ìˆ˜ ë³€ê²½
TENANT_SLUG=company-a â†’ TENANT_SLUG=company-c

# 2. Redeploy ë²„íŠ¼ í´ë¦­

# 3. ìƒˆ ë°°í¬ë¶€í„° company-c ë°ì´í„° ì„œë¹™
```

**ëŸ°íƒ€ì„ì—ëŠ” ì ˆëŒ€ ë³€ê²½ ë¶ˆê°€ëŠ¥!** (ì™„ë²½í•œ ê²©ë¦¬ ë³´ì¥)

---

## ì„±ëŠ¥ ìµœì í™”

### 1. í…Œë„ŒíŠ¸ ì •ë³´ ìºì‹±

```typescript
// src/lib/supabase/server.ts
let cachedTenant: { id: string } | null = null

async function getTenant() {
  if (!cachedTenant) {
    // DB ì¡°íšŒëŠ” ì„œë²„ ì‹œì‘ ì‹œ 1íšŒë§Œ
    const { data } = await supabaseAdmin
      .from('tenants')
      .select('id, name, theme')
      .eq('slug', tenantSlug)
      .single()

    cachedTenant = data
  }

  return cachedTenant
}
```

### 2. ì¸ë±ìŠ¤ ìµœì í™”

```sql
-- ìì£¼ ì¡°íšŒí•˜ëŠ” ì¡°í•©ì— ì¸ë±ìŠ¤ ì¶”ê°€
CREATE INDEX idx_products_tenant_category ON products(tenant_id, category_id);
CREATE INDEX idx_products_tenant_badge ON products(tenant_id, badge) WHERE badge IS NOT NULL;
```

### 3. ì¿¼ë¦¬ ìµœì í™”

```typescript
// í•„ìš”í•œ ì»¬ëŸ¼ë§Œ select
const { data } = await supabase
  .from('products')
  .select('id, name, price, image_url')
  .limit(12)
```

---

## ë¹„ìš© ë¶„ì„

### í˜„ì¬ êµ¬ì¡° (ì—…ì¥ë³„ Supabase)

| í•­ëª© | ë¹„ìš© (5ê°œ ì—…ì¥) |
|------|-----------------|
| Supabase Pro | 5 Ã— $25 = **$125/ì›”** |
| ì—°ê°„ | **$1,500** |

### ë©€í‹° í…Œë„ŒíŠ¸ ì „í™˜ í›„

| í•­ëª© | ë¹„ìš© (5ê°œ ì—…ì¥) |
|------|-----------------|
| Supabase ë¬´ë£Œ í”Œëœ | **$0/ì›”** |
| Supabase Pro (í•„ìš” ì‹œ) | **$25/ì›”** |
| ì—°ê°„ ì ˆê°ì•¡ | **$1,200~$1,500** |

**ê²°ë¡ **: ì—°ê°„ ìµœì†Œ $1,200 ì ˆê°! ğŸ‰

---

## ë§ˆì´ê·¸ë ˆì´ì…˜ ì²´í¬ë¦¬ìŠ¤íŠ¸

- [ ] DB ë§ˆì´ê·¸ë ˆì´ì…˜ íŒŒì¼ ì‘ì„± (`tenants` í…Œì´ë¸”, `tenant_id` ì¶”ê°€)
- [ ] ë§ˆì´ê·¸ë ˆì´ì…˜ ì‹¤í–‰: `supabase db push`
- [ ] ì‹œë“œ ë°ì´í„° ì‚½ì… (í…Œë„ŒíŠ¸ 2ê°œ ì´ìƒ)
- [ ] `src/lib/supabase/server.ts` ìƒì„±
- [ ] ê¸°ì¡´ í˜ì´ì§€ë¥¼ Server Componentë¡œ ì „í™˜
- [ ] ë¡œì»¬ í™˜ê²½ë³€ìˆ˜ ì„¤ì • (`TENANT_SLUG`, `SUPABASE_SERVICE_ROLE_KEY`)
- [ ] ë¡œì»¬ì—ì„œ í…Œë„ŒíŠ¸ ì „í™˜ í…ŒìŠ¤íŠ¸ (í™˜ê²½ë³€ìˆ˜ ë³€ê²½ í›„ ì¬ì‹œì‘)
- [ ] Vercel í”„ë¡œì íŠ¸ A ë°°í¬ (ENV: `TENANT_SLUG=company-a`)
- [ ] Vercel í”„ë¡œì íŠ¸ B ë°°í¬ (ENV: `TENANT_SLUG=company-b`)
- [ ] ê° ë„ë©”ì¸ì—ì„œ ë°ì´í„° ê²©ë¦¬ ê²€ì¦
- [ ] ë¸Œë¼ìš°ì € ì½˜ì†”ì—ì„œ ì¡°ì‘ ì‹œë„ (ì°¨ë‹¨ë˜ëŠ”ì§€ í™•ì¸)

---

## íŠ¸ëŸ¬ë¸”ìŠˆíŒ…

### Q1: "Invalid tenant" ì—ëŸ¬ ë°œìƒ

**ì›ì¸**: `TENANT_SLUG` í™˜ê²½ë³€ìˆ˜ì™€ DBì˜ `slug`ê°€ ë¶ˆì¼ì¹˜

**í•´ê²°**:
```sql
-- DBì— í•´ë‹¹ í…Œë„ŒíŠ¸ê°€ ìˆëŠ”ì§€ í™•ì¸
SELECT * FROM tenants WHERE slug = 'company-a';

-- ì—†ìœ¼ë©´ ì¶”ê°€
INSERT INTO tenants (slug, name) VALUES ('company-a', 'ì—…ì¥ A');
```

### Q2: ëª¨ë“  í…Œë„ŒíŠ¸ ë°ì´í„°ê°€ ë³´ì„

**ì›ì¸**: `tenant_id` í•„í„°ê°€ ì ìš©ë˜ì§€ ì•ŠìŒ

**í•´ê²°**:
```typescript
// âŒ ì˜ëª»ëœ ì‚¬ìš©
import { supabase } from '@/lib/supabase/client'
await supabase.from('products').select('*') // tenant_id í•„í„° ì—†ìŒ!

// âœ… ì˜¬ë°”ë¥¸ ì‚¬ìš©
import { getServerSupabase } from '@/lib/supabase/server'
const supabase = await getServerSupabase()
await supabase.from('products').select('*') // tenant_id ìë™ í•„í„°ë§!
```

### Q3: í´ë¼ì´ì–¸íŠ¸ ì»´í¬ë„ŒíŠ¸ì—ì„œ DB ì ‘ê·¼ í•„ìš”

**í•´ê²°**: API ë¼ìš°íŠ¸ ì‚¬ìš© (2.4 ì°¸ì¡°)

---

## ì°¸ê³  ìë£Œ

- [Supabase Service Role](https://supabase.com/docs/guides/api/api-keys#the-servicerole-key)
- [Next.js Server Components](https://nextjs.org/docs/app/building-your-application/rendering/server-components)
- [Vercel í™˜ê²½ë³€ìˆ˜ ê´€ë¦¬](https://vercel.com/docs/projects/environment-variables)

---

**ë¬¸ì„œ ìµœì¢… ì—…ë°ì´íŠ¸**: 2025-01-26
